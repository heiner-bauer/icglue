<%
    #----------------------------------------#
    #  ^..^                                  #
    # ( oo )  )~                             #
    #   ,,  ,,                               #
    #----------------------------------------#
    # register file latex template           #
    #----------------------------------------#

%><%
########################################################################
    proc get_padding_size { width string } {
        set string_length [string length $string]
        set padding       [expr {$width - $string_length} ]
        return $padding
    }

    proc tex_escape {string_in} {
        set string_out $string_in
        set string_out [string map [list "\_" "\\_" ] $string_out]
        set string_out [string map [list "\&" "\\&" ] $string_out]
        set string_out [string map [list "\%" "\\%" ] $string_out]
        set string_out [string map [list "\|" "\\|" ] $string_out]
        set string_out [string map [list "\{" "\\\{"] $string_out]
        set string_out [string map [list "\}" "\\\}"] $string_out]
        set string_out [string map [list "\^" "\\^" ] $string_out]
        set string_out [string map [list "\#" "\\#" ] $string_out]
        set string_out [string map [list "\~" "\\~" ] $string_out]
        return $string_out
    }

    proc cnt_required_escapes {string_in} {
        set cnt 0

        set cnt [expr {[llength [split $string_in "\_"]]- 1 + $cnt}]
        set cnt [expr {[llength [split $string_in "\&"]]- 1 + $cnt}]
        set cnt [expr {[llength [split $string_in "\%"]]- 1 + $cnt}]
        set cnt [expr {[llength [split $string_in "\|"]]- 1 + $cnt}]
        set cnt [expr {[llength [split $string_in "\{"]]- 1 + $cnt}]
        set cnt [expr {[llength [split $string_in "\}"]]- 1 + $cnt}]
        set cnt [expr {[llength [split $string_in "\^"]]- 1 + $cnt}]
        set cnt [expr {[llength [split $string_in "\#"]]- 1 + $cnt}]
        set cnt [expr {[llength [split $string_in "\~"]]- 1 + $cnt}]
        if {$cnt <0} {
            set cnt 0
        }
        return $cnt
    }

    proc max_array_entry_len_tex {array_list array_entry} {
        set len 0
        foreach i_entry $array_list {
            array set i_a $i_entry
            set i_len [string length $i_a($array_entry)]
            set escapes [cnt_required_escapes $i_a($array_entry)]
            set i_len [expr {$i_len + $escapes}]
            set len [expr {max ($len, $i_len)}]
        }
        return $len
    }

########################################################################
    set register_list [regfile_to_arraylist $obj_id]
    foreach i_register $register_list {
        array set register $i_register
        foreach i_sreg $register(regs) {
            array set sreg $i_sreg
        }
    }
    set rf_name [object_name $obj_id]
    # define table header text
    #set header { "Name" "Bits" "R/W" "Function" }
    set header { "Register Name" "Address" "Name" "Width" "Access" "Align" "Reset" "Description"}

    set column_width { 0 0 0 0 0 0 0 0 }
    set num_column   { 0 1 2 3 4 5 6 7 }

    set len_max_data(0) 0
    set len_max_data(1) 0
    set len_max_data(2) 0
    set len_max_data(3) 0
    set len_max_data(4) 0
    set len_max_data(5) 0
    set len_max_data(6) 0
    set len_max_data(7) 0

    foreach_array register $register_list {
        foreach_array sreg $register(regs) {
            set len_max_tmp(0)  [max_array_entry_len_tex $register_list  name      ]
            set len_max_tmp(1)  [max_array_entry_len_tex $register_list  address   ]
            set len_max_tmp(2)  [max_array_entry_len_tex $register(regs) name      ]
            set len_max_tmp(3)  [max_array_entry_len_tex $register(regs) width     ]
            set len_max_tmp(4)  [max_array_entry_len_tex $register(regs) type      ]
            set len_max_tmp(5)  [max_array_entry_len_tex $register(regs) entrybits ]
            set len_max_tmp(6)  [max_array_entry_len_tex $register(regs) reset     ]
            set len_max_tmp(7)  [max_array_entry_len_tex $register(regs) comment   ]

            set len_max_data(0) [expr {max ($len_max_tmp(0), $len_max_data(0))}]
            set len_max_data(1) [expr {max ($len_max_tmp(1), $len_max_data(1))}]
            set len_max_data(2) [expr {max ($len_max_tmp(2), $len_max_data(2))}]
            set len_max_data(3) [expr {max ($len_max_tmp(3), $len_max_data(3))}]
            set len_max_data(4) [expr {max ($len_max_tmp(4), $len_max_data(4))}]
            set len_max_data(5) [expr {max ($len_max_tmp(5), $len_max_data(5))}]
            set len_max_data(6) [expr {max ($len_max_tmp(6), $len_max_data(6))}]
            set len_max_data(7) [expr {max ($len_max_tmp(7), $len_max_data(7))}]
        }
    }

    foreach i_column $num_column {
        set text    [lindex $header $i_column ]
        set text    [tex_escape $text ]
        set text    [concat "\\textbf\{" $text "\}"]

        set len_header [string length $text]

        if {$len_header >  $len_max_data($i_column)} {
            lset column_width $i_column $len_header
        } else {
            lset column_width $i_column $len_max_data($i_column)
        }
        set debug [lindex $column_width $i_column]
    }


%>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% !!! do not modify this file unless you know what you are doing !!!
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\newcommand {\getRegHeader}{Register Name & Address & Name & Width & Access & Align & Reset & Description \\}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\newcommand {\getReg}[1]{%
%\IfStrEqCase{#1}{%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% register file
{<%=$rf_name%>}{%
<%  foreach_array reg $register_list {
    %>    \getReg{<%=$rf_name ":" $reg(name) "\}\%\n" %><%
    }
%>}%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% register
<%  foreach_array reg $register_list {
        %><%= "\{" $rf_name  ":" $reg(name) "\}\{\%\n"%><%
        foreach_array sreg $reg(regs) {
        %>    \getReg{<%=$rf_name ":" $reg(name) ":"  $sreg(name) "\}\%\n" %><%
        }
        %><%="\}\%\n"%><%
    }
%>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% register address
<%  foreach_array reg $register_list {
        %><%= "\{" $rf_name  ":" $reg(name) ".addr\}\{"%><[format "0x%08x" $reg(address)]><%= "\}\%\n"%><%
    }
%>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% register content
<%
foreach_array reg $register_list {
    set i_sreg 0
    foreach_array sreg $reg(regs) {
        %><%= "\{" $rf_name  ":" $reg(name) ":" $sreg(name) "\}\{" %><%
        if {$i_sreg == 0} {
            %><%= [tex_escape $reg(name)] " \& \\getReg\{" $rf_name  ":" $reg(name) ".addr\} \& "%><%
        } else {
            %>& & <%
        }
        %><%= [tex_escape $sreg(name)] " \& " [tex_escape $sreg(width)] " \& " [tex_escape $sreg(type)] " \& " [tex_escape $sreg(entrybits)] " \& " [tex_escape $sreg(reset)] " \& " [tex_escape $sreg(comment)] "\\\\\}\%\n" %><%
        incr i_sreg
    }
}
%>%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%    }
%}